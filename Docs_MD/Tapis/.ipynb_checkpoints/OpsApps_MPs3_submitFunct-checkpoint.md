## OpenSeesMP App Python Def

This code was generated by AI, is not tested, and is intended to serve as a basis for your development. It is, likely, incomplete and inconsistent.

## Function-Based Submission for OpenSeesMP with Tapipy

```python
from tapipy.tapis import Tapis
from datetime import datetime
import time

# 1. Authenticate and return a Tapis client
def get_tapis_client(access_token, base_url="https://tacc.tapis.io"):
    return Tapis(base_url=base_url, access_token=access_token)

# 2. Submit a job to the OpenSeesMP Tapis app
def submit_openseesmp_job(t, input_dir, main_script,
                          node_count=2,
                          cores_per_node=48,
                          max_minutes=120,
                          app_id="opensees-mp-s3",
                          job_name_prefix="openseesMP"):

    job_name = f"{job_name_prefix}-{datetime.now().strftime('%Y%m%d-%H%M%S')}"
    print(f"Submitting job: {job_name}")

    job = t.jobs.submitJob({
        "name": job_name,
        "appId": app_id,
        "nodeCount": node_count,
        "coresPerNode": cores_per_node,
        "maxMinutes": max_minutes,
        "inputs": {
            "inputDirectory": input_dir
        },
        "parameters": {
            "Main Script": main_script
        }
    })

    print(f"‚úÖ Job submitted! ID: {job.id}")
    return job

# 3. Check job status
def get_job_status(t, job_id):
    job_info = t.jobs.getJob(job_id)
    return job_info.status

# 4. Wait for job completion
def wait_for_completion(t, job_id, check_interval=30):
    print(f"‚è≥ Waiting for job {job_id} to complete...")
    while True:
        status = get_job_status(t, job_id)
        print(f"[{datetime.now().strftime('%H:%M:%S')}] Status: {status}")
        if status in ["FINISHED", "FAILED", "CANCELLED"]:
            print(f"üéâ Job finished with status: {status}")
            break
        time.sleep(check_interval)

# 5. Get archive path after job completes
def get_job_archive_path(t, job_id):
    job_info = t.jobs.getJob(job_id)
    return job_info.archivePath

# 6. List output files in archive
def list_output_files(t, archive_path, system_id="stampede3"):
    return t.files.listFiles(systemId=system_id, path=archive_path)
```

## Example: Full Job Submission Workflow

```python
# STEP 1: Authenticate
t = get_tapis_client(access_token="your_token_here")

# STEP 2: Submit a job
job = submit_openseesmp_job(
    t,
    input_dir="designsafe.storage.default:/myuser/projects/opensees-tests/run01",
    main_script="model.tcl"
)

# STEP 3: Wait for it to complete
wait_for_completion(t, job.id)

# STEP 4: Get archive location
archive_path = get_job_archive_path(t, job.id)
print(f"üìÇ Archive Path: {archive_path}")

# STEP 5: List output files
files = list_output_files(t, archive_path)
for f in files:
    print(f.name)
```

