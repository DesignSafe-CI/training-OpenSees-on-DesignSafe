# OpenSeesMP App Python Class

Here’s a reusable Python helper class to streamline submitting and managing OpenSeesMP jobs via Tapipy. It wraps the job creation, monitoring, and file access into convenient methods so you can reuse it in a notebook or script.

This code was generated by AI, is not tested, and is intended to serve as a basis for your development. It is, likely, incomplete and inconsistent.


## `OpenSeesMPJob` Python Class for Tapipy

```python
from tapipy.tapis import Tapis
from datetime import datetime
import time

class OpenSeesMPJob:
    def __init__(self, access_token, input_dir, main_script,
                 base_url="https://tacc.tapis.io",
                 app_id="opensees-mp-s3",
                 node_count=2,
                 cores_per_node=48,
                 max_minutes=120,
                 job_name_prefix="openseesMP"):

        self.t = Tapis(base_url=base_url, access_token=access_token)
        self.app_id = app_id
        self.job_name = f"{job_name_prefix}-{datetime.now().strftime('%Y%m%d-%H%M%S')}"
        self.input_dir = input_dir
        self.main_script = main_script
        self.node_count = node_count
        self.cores_per_node = cores_per_node
        self.max_minutes = max_minutes
        self.job = None

    def submit(self):
        print(f"Submitting job: {self.job_name}")
        self.job = self.t.jobs.submitJob({
            "name": self.job_name,
            "appId": self.app_id,
            "nodeCount": self.node_count,
            "coresPerNode": self.cores_per_node,
            "maxMinutes": self.max_minutes,
            "inputs": {
                "inputDirectory": self.input_dir
            },
            "parameters": {
                "Main Script": self.main_script
            }
        })
        print(f"Job submitted! ID: {self.job.id}")
        return self.job

    def status(self):
        if not self.job:
            raise RuntimeError("Job not submitted yet.")
        job_info = self.t.jobs.getJob(self.job.id)
        return job_info.status

    def wait_for_completion(self, check_interval=30):
        if not self.job:
            raise RuntimeError("Job not submitted yet.")
        print(f"Waiting for job {self.job.id} to complete...")
        while True:
            status = self.status()
            print(f"[{datetime.now().strftime('%H:%M:%S')}] Status: {status}")
            if status in ["FINISHED", "FAILED", "CANCELLED"]:
                print("Job complete.")
                break
            time.sleep(check_interval)

    def get_archive_uri(self):
        if not self.job:
            raise RuntimeError("Job not submitted yet.")
        job_info = self.t.jobs.getJob(self.job.id)
        return job_info.archivePath

    def list_output_files(self):
        path = self.get_archive_uri()
        return self.t.files.listFiles(systemId="stampede3", path=path)

    def print_summary(self):
        print(f"Job Name: {self.job_name}")
        print(f"App ID: {self.app_id}")
        print(f"Input Dir: {self.input_dir}")
        print(f"Main Script: {self.main_script}")
        print(f"Nodes × Cores: {self.node_count} × {self.cores_per_node}")
        print(f"Max Runtime: {self.max_minutes} minutes")
```

## Example Usage

```python
# Create and submit a job
job_runner = OpenSeesMPJob(
    access_token="your_access_token",
    input_dir="designsafe.storage.default:/myuser/projects/opensees-tests/run01",
    main_script="model.tcl"
)

job_runner.print_summary()
job_runner.submit()

# Monitor job status
job_runner.wait_for_completion()

# List archived output files
files = job_runner.list_output_files()
for f in files:
    print(f.name)
```

